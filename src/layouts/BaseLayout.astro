---
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';
import '../styles/tailwind.css';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = "Arjit's Blog",
  description = 'Pentesting, red teaming, CTF writeups and security research.',
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <title>{title !== "Arjit's Blog" ? `${title} | Arjit's Blog` : "Arjit's Blog"}</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" crossorigin="anonymous" />
</head>
<body>
  <Navbar />
  <slot />
  <Footer />

  <button id="scroll-top" aria-label="Scroll to top" title="Scroll to top">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M8 6L12 2L16 6"/><path d="M12 2V22"/><path d="M8 12L12 8L16 12"/>
    </svg>
  </button>

  <script>
    const btn = document.getElementById('scroll-top');
    window.addEventListener('scroll', () => btn?.classList.toggle('visible', window.scrollY > 300), { passive: true });
    btn?.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
  </script>

  <!-- Mermaid: loaded from CDN only when diagrams exist on the page -->
  <script type="module">
    document.addEventListener('DOMContentLoaded', async () => {
      const diagrams = document.querySelectorAll('.mermaid-diagram');
      if (diagrams.length === 0) return;

      const { default: mermaid } = await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs');

      mermaid.initialize({
        startOnLoad: false,
        theme: 'dark',
        darkMode: true,
        themeVariables: {
          background:           '#0d1117',
          mainBkg:              '#1a2332',
          nodeBorder:           '#00d4aa',
          lineColor:            '#00a885',
          primaryColor:         '#1a2332',
          primaryBorderColor:   '#00d4aa',
          primaryTextColor:     '#e2e8f0',
          secondaryColor:       '#111827',
          secondaryBorderColor: '#1e3a4a',
          secondaryTextColor:   '#94a3b8',
          tertiaryColor:        '#1e2d3d',
          tertiaryBorderColor:  '#2a5060',
          tertiaryTextColor:    '#94a3b8',
          edgeLabelBackground:  '#111827',
          clusterBkg:           '#111827',
          clusterBorder:        '#1e3a4a',
          titleColor:           '#e2e8f0',
          fontFamily:           'JetBrains Mono, monospace',
          fontSize:             '14px',
        },
        flowchart: { curve: 'basis', htmlLabels: true },
        sequence:  { actorMargin: 50 },
        gantt:     { axisFormat: '%Y-%m-%d' },
      });

      let id = 0;
      for (const el of diagrams) {
        const encoded = el.getAttribute('data-mermaid');
        if (!encoded) continue;
        const code = decodeURIComponent(encoded);
        el.classList.add('mermaid-loading');
        el.textContent = 'Rendering diagram\u2026';
        try {
          const { svg } = await mermaid.render(`mermaid-svg-${id++}`, code);
          el.innerHTML = svg;
          el.classList.remove('mermaid-loading');
        } catch (err) {
          el.classList.remove('mermaid-loading');
          el.classList.add('mermaid-error');
          el.innerHTML = `<strong>\u26a0 Mermaid error</strong><pre>${err.message ?? err}</pre>`;
        }
      }
    });
  </script>
</body>
</html>